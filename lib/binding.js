// Generated by CoffeeScript 1.7.1
(function() {
  var BargeBinding, DEFAULT_BIND, DEFAULT_PORT, DEFAULT_PROTO, log, randomString, util, zmq, _ref;

  zmq = require('zmq');

  util = require('util');

  _ref = require('./helpers'), randomString = _ref.randomString, log = _ref.log;

  DEFAULT_PROTO = 'tcp';

  DEFAULT_BIND = '0.0.0.0';

  DEFAULT_PORT = 5555;

  module.exports = BargeBinding = (function() {
    function BargeBinding(options) {
      if (options == null) {
        options = {};
      }
      this.id = this.id || randomString();
      this.proto = options.proto || DEFAULT_PROTO;
      this.host = DEFAULT_BIND;
      this.port = options.port || DEFAULT_PORT;
      this.address = this.proto + '://' + this.host + ':' + this.port;
      this.socket = zmq.socket('router');
      this.socket.bindSync(this.address);
      this.socket.on('message', (function(_this) {
        return function(client_id, message_json) {
          return _this.handleMessage(client_id.toString(), JSON.parse(message_json));
        };
      })(this));
      log("Socket " + this.id + " bound to " + this.address + "...");
    }

    BargeBinding.prototype.send = function(client_id, message) {
      return this.socket.send([client_id, JSON.stringify(message)]);
    };

    BargeBinding.prototype.handleMessage = function(client_id, message) {
      if (VERBOSE) {
        return log("<" + client_id + ">: " + (util.inspect(message)));
      }
    };

    return BargeBinding;

  })();

}).call(this);
